server {
    server_name "~^(.*)$";

    if ($http_x_forwarded_proto = "https") {
        set $scheme "https";
    }
    return 301 $scheme://www.$1$request_uri;
}
